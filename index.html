<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Massachusetts Migration Analysis - Census 2025 Data</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        const { 
            LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, ReferenceLine, ComposedChart 
        } = Recharts;

        function MAMigrationDashboard() {
            const [activeTab, setActiveTab] = useState('overview');

            // Historical annual data
            const annualData = [
                { year: '2020-21', domestic: -1762, international: 1762, net: 0 },
                { year: '2021-22', domestic: -48000, international: 72892, net: 24892 },
                { year: '2022-23', domestic: -35400, international: 74610, net: 39210 },
                { year: '2023-24', domestic: -19200, international: 90217, net: 71017 },
                { year: '2024-25', domestic: -33340, international: 56600, net: 23260 },
            ];

            // Cumulative data
            const cumulativeData = [
                { year: '2020', domestic: 0, international: 0, net: 0, population: 7.029 },
                { year: '2021', domestic: -1762, international: 1762, net: 0, population: 7.035 },
                { year: '2022', domestic: -49762, international: 74654, net: 24892, population: 7.065 },
                { year: '2023', domestic: -85162, international: 149264, net: 64102, population: 7.100 },
                { year: '2024', domestic: -104362, international: 239481, net: 135119, population: 7.130 },
                { year: '2025', domestic: -137702, international: 296081, net: 158379, population: 7.150 },
            ];

            // Projection data
            const projectionData = [
                { year: '2025', statusQuo: 7.150, current: 7.150, likely: 7.150, pessimistic: 7.150, worst: 7.150 },
                { year: '2026', statusQuo: 7.220, current: 7.170, likely: 7.160, pessimistic: 7.140, worst: 7.120 },
                { year: '2027', statusQuo: 7.290, current: 7.180, likely: 7.150, pessimistic: 7.100, worst: 7.050 },
                { year: '2028', statusQuo: 7.360, current: 7.175, likely: 7.120, pessimistic: 7.040, worst: 6.950 },
                { year: '2029', statusQuo: 7.430, current: 7.165, likely: 7.080, pessimistic: 6.960, worst: 6.830 },
                { year: '2030', statusQuo: 7.500, current: 7.150, likely: 7.030, pessimistic: 6.870, worst: 6.700 },
            ];

            // Why people leave data
            const reasonsData = [
                { reason: 'Taxes', importance: 100 },
                { reason: 'Housing Costs', importance: 95 },
                { reason: 'Healthcare', importance: 85 },
                { reason: 'Traffic', importance: 70 },
            ];

            const TabButton = ({ id, label }) => (
                <button
                    onClick={() => setActiveTab(id)}
                    className={`px-3 py-2 text-sm font-semibold rounded-t-lg transition-colors ${
                        activeTab === id
                            ? 'bg-white text-blue-600 border-t-2 border-x border-blue-600'
                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`}
                >
                    {label}
                </button>
            );

            const MetricCard = ({ title, value, subtitle, color = 'blue' }) => {
                const colors = {
                    blue: 'bg-blue-50 border-blue-200 text-blue-700',
                    red: 'bg-red-50 border-red-200 text-red-700',
                    green: 'bg-green-50 border-green-200 text-green-700',
                    purple: 'bg-purple-50 border-purple-200 text-purple-700',
                };
                return (
                    <div className={`p-3 rounded-lg border-2 ${colors[color]}`}>
                        <div className="text-xs font-medium opacity-80">{title}</div>
                        <div className="text-xl font-bold">{value}</div>
                        {subtitle && <div className="text-xs opacity-70">{subtitle}</div>}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-4">
                            <h1 className="text-2xl font-bold text-gray-800">Massachusetts Migration Analysis</h1>
                            <p className="text-gray-600 text-sm">Census Bureau Vintage 2025 Data (Released Jan 27, 2026)</p>
                        </div>

                        {/* Key Metrics Row */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2 mb-4">
                            <MetricCard title="Residents Left (2020-25)" value="-137,702" subtitle="Domestic outmigration" color="red" />
                            <MetricCard title="Immigrants Arrived" value="+296,081" subtitle="International migration" color="blue" />
                            <MetricCard title="Net Migration" value="+158,379" subtitle="Immigration saved MA" color="green" />
                            <MetricCard title="Shelter Spending" value="$1.83B" subtitle="FY2024-FY2025" color="purple" />
                        </div>

                        {/* Alert Box */}
                        <div className="bg-orange-100 border-l-4 border-orange-500 p-3 mb-4 rounded text-sm">
                            <span className="font-bold text-orange-800">‚ö†Ô∏è 2024-25 Changes: </span>
                            <span className="text-orange-700">
                                Immigration ‚Üì37% (90K‚Üí57K) | Exodus ‚Üë74% (19K‚Üí33K) | Census projects 75% more drop by 2026
                            </span>
                        </div>

                        {/* Tabs */}
                        <div className="flex flex-wrap gap-1 mb-0">
                            <TabButton id="overview" label="üìä Overview" />
                            <TabButton id="annual" label="üìÖ Annual" />
                            <TabButton id="cumulative" label="üìà Cumulative" />
                            <TabButton id="projection" label="üîÆ 2030" />
                            <TabButton id="reasons" label="‚ùì Why Leave" />
                        </div>

                        {/* Tab Content */}
                        <div className="bg-white border rounded-b-lg rounded-tr-lg p-4 shadow">
                            
                            {/* Overview Tab */}
                            {activeTab === 'overview' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-3">The Massachusetts Paradox</h2>
                                    
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <h3 className="font-bold text-gray-700 mb-2 text-sm">Annual Migration Pattern</h3>
                                            <ResponsiveContainer width="100%" height={220}>
                                                <BarChart data={annualData}>
                                                    <CartesianGrid strokeDasharray="3 3" />
                                                    <XAxis dataKey="year" tick={{ fontSize: 10 }} />
                                                    <YAxis tickFormatter={(v) => `${v/1000}K`} tick={{ fontSize: 10 }} />
                                                    <Tooltip formatter={(v) => v.toLocaleString()} />
                                                    <Legend wrapperStyle={{ fontSize: '11px' }} />
                                                    <Bar dataKey="domestic" name="Left" fill="#ef4444" />
                                                    <Bar dataKey="international" name="Arrived" fill="#3b82f6" />
                                                </BarChart>
                                            </ResponsiveContainer>
                                        </div>

                                        <div>
                                            <h3 className="font-bold text-gray-700 mb-2 text-sm">The Bottom Line</h3>
                                            <div className="bg-gray-50 p-3 rounded-lg text-sm">
                                                <p className="mb-2">
                                                    <span className="font-bold text-red-600">137,702</span> residents 
                                                    left for other states since 2020.
                                                </p>
                                                <p className="mb-2">
                                                    <span className="font-bold text-blue-600">296,081</span> immigrants arrived, 
                                                    covering the exodus <strong>twice over</strong>.
                                                </p>
                                                <p className="mb-2 p-2 bg-yellow-100 rounded text-xs">
                                                    <strong>Without immigration, MA would have LOST ~112,000 people.</strong>
                                                </p>
                                                <p className="text-gray-600 text-xs">
                                                    Immigration is the <em>only</em> reason MA population grew.
                                                    Now both trends are reversing.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-4 p-3 bg-red-50 rounded-lg border border-red-200">
                                        <h3 className="font-bold text-red-800 mb-1 text-sm">üö® Congressional Seat at Risk</h3>
                                        <p className="text-red-700 text-xs">
                                            If population drops below ~6.79M by 2030, Massachusetts loses its 9th Congressional seat.
                                            Under pessimistic scenarios, this is now a real possibility.
                                        </p>
                                    </div>
                                </div>
                            )}

                            {/* Annual Data Tab */}
                            {activeTab === 'annual' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-3">Annual Migration Data</h2>
                                    
                                    <div className="overflow-x-auto mb-4">
                                        <table className="w-full border-collapse text-sm">
                                            <thead>
                                                <tr className="bg-gray-100">
                                                    <th className="border p-2 text-left">Period</th>
                                                    <th className="border p-2 text-right">Domestic</th>
                                                    <th className="border p-2 text-right">International</th>
                                                    <th className="border p-2 text-right">Net</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {annualData.map((row, i) => (
                                                    <tr key={i} className={i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                        <td className="border p-2 font-medium">{row.year}</td>
                                                        <td className="border p-2 text-right text-red-600 font-mono">{row.domestic.toLocaleString()}</td>
                                                        <td className="border p-2 text-right text-blue-600 font-mono">+{row.international.toLocaleString()}</td>
                                                        <td className="border p-2 text-right font-mono font-bold">{row.net > 0 ? '+' : ''}{row.net.toLocaleString()}</td>
                                                    </tr>
                                                ))}
                                                <tr className="bg-gray-200 font-bold">
                                                    <td className="border p-2">TOTAL</td>
                                                    <td className="border p-2 text-right text-red-600 font-mono">-137,702</td>
                                                    <td className="border p-2 text-right text-blue-600 font-mono">+296,081</td>
                                                    <td className="border p-2 text-right font-mono">+158,379</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <ResponsiveContainer width="100%" height={250}>
                                        <ComposedChart data={annualData}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="year" tick={{ fontSize: 10 }} />
                                            <YAxis tickFormatter={(v) => `${v/1000}K`} tick={{ fontSize: 10 }} />
                                            <Tooltip formatter={(v) => v.toLocaleString()} />
                                            <Legend wrapperStyle={{ fontSize: '11px' }} />
                                            <Bar dataKey="domestic" name="Residents Left" fill="#ef4444" />
                                            <Bar dataKey="international" name="Immigrants Arrived" fill="#3b82f6" />
                                            <Line type="monotone" dataKey="net" name="Net Total" stroke="#000" strokeWidth={2} dot={{ r: 4 }} />
                                        </ComposedChart>
                                    </ResponsiveContainer>
                                </div>
                            )}

                            {/* Cumulative Tab */}
                            {activeTab === 'cumulative' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-3">Cumulative Migration Since 2020</h2>
                                    
                                    <ResponsiveContainer width="100%" height={300}>
                                        <LineChart data={cumulativeData}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="year" tick={{ fontSize: 10 }} />
                                            <YAxis tickFormatter={(v) => `${v/1000}K`} domain={[-150000, 350000]} tick={{ fontSize: 10 }} />
                                            <Tooltip formatter={(v) => v.toLocaleString()} />
                                            <Legend wrapperStyle={{ fontSize: '11px' }} />
                                            <ReferenceLine y={0} stroke="#000" strokeWidth={2} />
                                            <Line type="monotone" dataKey="international" name="Immigrants" stroke="#3b82f6" strokeWidth={3} dot={{ r: 4 }} />
                                            <Line type="monotone" dataKey="net" name="Net Migration" stroke="#22c55e" strokeWidth={3} dot={{ r: 4 }} />
                                            <Line type="monotone" dataKey="domestic" name="Residents Left" stroke="#ef4444" strokeWidth={3} dot={{ r: 4 }} />
                                        </LineChart>
                                    </ResponsiveContainer>

                                    <div className="grid grid-cols-3 gap-2 mt-4">
                                        <div className="p-3 bg-blue-50 rounded-lg text-center">
                                            <div className="text-2xl font-bold text-blue-600">+296K</div>
                                            <div className="text-xs text-blue-800">Total Immigrants</div>
                                        </div>
                                        <div className="p-3 bg-red-50 rounded-lg text-center">
                                            <div className="text-2xl font-bold text-red-600">-138K</div>
                                            <div className="text-xs text-red-800">Residents Left</div>
                                        </div>
                                        <div className="p-3 bg-green-50 rounded-lg text-center">
                                            <div className="text-2xl font-bold text-green-600">+158K</div>
                                            <div className="text-xs text-green-800">Net Gain</div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Projection Tab */}
                            {activeTab === 'projection' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-3">Population Projections to 2030</h2>
                                    
                                    <ResponsiveContainer width="100%" height={320}>
                                        <LineChart data={projectionData}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="year" tick={{ fontSize: 10 }} />
                                            <YAxis domain={[6.6, 7.6]} tickFormatter={(v) => `${v}M`} tick={{ fontSize: 10 }} />
                                            <Tooltip formatter={(v) => v ? `${v}M` : 'N/A'} />
                                            <Legend wrapperStyle={{ fontSize: '10px' }} />
                                            <ReferenceLine y={6.79} stroke="#dc2626" strokeDasharray="5 5" strokeWidth={2} />
                                            <Line type="monotone" dataKey="statusQuo" name="Old (obsolete)" stroke="#9ca3af" strokeWidth={2} strokeDasharray="5 5" dot={{ r: 2 }} />
                                            <Line type="monotone" dataKey="current" name="Current" stroke="#3b82f6" strokeWidth={2} dot={{ r: 3 }} />
                                            <Line type="monotone" dataKey="likely" name="LIKELY" stroke="#f59e0b" strokeWidth={3} dot={{ r: 4 }} />
                                            <Line type="monotone" dataKey="pessimistic" name="Pessimistic" stroke="#ef4444" strokeWidth={2} dot={{ r: 3 }} />
                                            <Line type="monotone" dataKey="worst" name="Worst" stroke="#8b5cf6" strokeWidth={2} dot={{ r: 3 }} />
                                        </LineChart>
                                    </ResponsiveContainer>

                                    <div className="text-center text-red-600 font-bold text-sm mt-2">
                                        ‚Äî ‚Äî ‚Äî Seat Loss Threshold: 6.79M ‚Äî ‚Äî ‚Äî
                                    </div>

                                    <div className="overflow-x-auto mt-4">
                                        <table className="w-full border-collapse text-xs">
                                            <thead>
                                                <tr className="bg-gray-100">
                                                    <th className="border p-1 text-left">Scenario</th>
                                                    <th className="border p-1 text-right">2030</th>
                                                    <th className="border p-1 text-center">Loses Seat?</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr className="bg-blue-50">
                                                    <td className="border p-1 text-blue-600">Current Trend</td>
                                                    <td className="border p-1 text-right font-mono">7.15M</td>
                                                    <td className="border p-1 text-center text-green-600 font-bold">No</td>
                                                </tr>
                                                <tr className="bg-orange-50">
                                                    <td className="border p-1 text-orange-600 font-bold">LIKELY</td>
                                                    <td className="border p-1 text-right font-mono">7.03M</td>
                                                    <td className="border p-1 text-center text-orange-600 font-bold">Close</td>
                                                </tr>
                                                <tr className="bg-red-50">
                                                    <td className="border p-1 text-red-600">Pessimistic</td>
                                                    <td className="border p-1 text-right font-mono">6.87M</td>
                                                    <td className="border p-1 text-center text-red-600 font-bold">YES</td>
                                                </tr>
                                                <tr className="bg-purple-50">
                                                    <td className="border p-1 text-purple-600">Worst Case</td>
                                                    <td className="border p-1 text-right font-mono">6.70M</td>
                                                    <td className="border p-1 text-center text-red-600 font-bold">YES</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* Reasons Tab */}
                            {activeTab === 'reasons' && (
                                <div>
                                    <h2 className="text-lg font-bold mb-3">Why Massachusetts Residents Leave</h2>
                                    <p className="text-gray-600 text-xs mb-3">Source: BU Finance Study (2024) + Economist Klepper-Smith</p>
                                    
                                    <ResponsiveContainer width="100%" height={200}>
                                        <BarChart data={reasonsData} layout="vertical">
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis type="number" domain={[0, 110]} tick={{ fontSize: 10 }} />
                                            <YAxis dataKey="reason" type="category" width={80} tick={{ fontSize: 10 }} />
                                            <Tooltip />
                                            <Bar dataKey="importance" name="Importance" fill="#ef4444" />
                                        </BarChart>
                                    </ResponsiveContainer>

                                    <div className="grid grid-cols-2 gap-3 mt-4">
                                        <div className="p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                            <h3 className="font-bold text-yellow-800 text-sm">Tax Foundation</h3>
                                            <p className="text-3xl font-bold text-yellow-600">43rd</p>
                                            <p className="text-yellow-700 text-xs">out of 50 in tax competitiveness</p>
                                        </div>
                                        
                                        <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                            <h3 className="font-bold text-blue-800 text-sm">The "Four T's"</h3>
                                            <ul className="text-blue-700 text-xs">
                                                <li>1. <strong>Taxes</strong></li>
                                                <li>2. <strong>Temperature</strong></li>
                                                <li>3. <strong>Traffic</strong></li>
                                                <li>4. <strong>Targeting</strong> (federal cuts)</li>
                                            </ul>
                                        </div>
                                    </div>

                                    <div className="mt-4 p-3 bg-gray-100 rounded-lg">
                                        <h3 className="font-bold mb-2 text-sm">The Vicious Cycle</h3>
                                        <div className="flex flex-wrap items-center justify-center gap-1 text-xs">
                                            <span className="bg-red-100 px-2 py-1 rounded">High taxes</span>
                                            <span>‚Üí</span>
                                            <span className="bg-red-100 px-2 py-1 rounded">Residents leave</span>
                                            <span>‚Üí</span>
                                            <span className="bg-blue-100 px-2 py-1 rounded">Immigration replaces</span>
                                            <span>‚Üí</span>
                                            <span className="bg-purple-100 px-2 py-1 rounded">$1.83B shelters</span>
                                            <span>‚Üí</span>
                                            <span className="bg-red-100 px-2 py-1 rounded">More taxes</span>
                                            <span>‚Üí</span>
                                            <span>üîÑ</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Footer */}
                        <div className="mt-3 text-center text-xs text-gray-500">
                            Sources: U.S. Census Bureau Vintage 2025 (Jan 27, 2026), IRS SOI Migration Data, BU Finance Study (2024)
                            <br />
                            <a href="https://github.com" className="text-blue-500 hover:underline">View on GitHub</a>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MAMigrationDashboard />);
    </script>
</body>
</html>
